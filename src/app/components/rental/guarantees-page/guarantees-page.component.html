<!--
<div class="guarantees-container">
  <h2>Réservation et garanties</h2>

  <div *ngIf="loading" class="loading">
    Chargement des informations...
  </div>

  <div *ngIf="error" class="error">
    Une erreur s'est produite lors du chargement des données.
  </div>

  @if(!car() || loading && !error){
    <p-progress-spinner />
  }@else{
    <div *ngIf="car()" class="car-info">
      <h3>Véhicule sélectionné</h3>
      <div class="car-details">
        <img [src]="car()?.image" alt="Image du véhicule">
        <div class="car-text">
          <h4>{{car()?.name}}</h4>
          <p>{{car()?.miles}} miles | {{car()?.agency?.name ?? ""}}</p>
          <p>{{car()?.description}}</p>
        </div>
      </div>
    </div>

    <div class="guarantees-list">
      <h3>Choisissez votre garantie</h3>
      <div *ngIf="guarantees().length === 0">
        Aucune garantie disponible.
      </div>

      <div *ngFor="let guarantee of guarantees()"
           class="guarantee-item"
           [class.selected]="isGuaranteeSelected(guarantee.id)"
           (click)="selectGuarantee(guarantee.id)">
        <div class="guarantee-content">
          <h4>Garantie #{{guarantee.id}}</h4>
          <p>État: {{guarantee.state}}</p>
          <p class="amount">Pourcentage: {{guarantee.amount * 100}} %</p>
          <p>Créée le: {{guarantee.createdAt | date:'dd/MM/yyyy'}}</p>
        </div>
        <div class="radio">
          <span *ngIf="isGuaranteeSelected(guarantee.id)" class="check-icon">✓</span>
        </div>
      </div>
    </div>

    <div>
      <label>
        <span>Date de départ :</span>
        <input type="date" class="w-full border rounded p-2" required [(ngModel)]="startDate">
      </label>
      <label>
        <span>Date de fin :</span>
        <input type="date" class="w-full border rounded p-2" required [(ngModel)]="endDate">
        @if(dateError){
          <p class="text-red-500 text-sm mt-1">{{ dateError }}</p>
        }
      </label>
    </div>

    <div class="actions">
      <button class="continue-button"
              (click)="next()"
              [disabled]="!isValid()">
        Continuer vers les options
      </button>
    </div>
  }

  <div *ngIf="!loading && !error">

  </div>
</div>
-->

<section class="min-h-screen bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 py-12">
  <!-- Éléments décoratifs -->
  <div class="absolute inset-0 opacity-5 overflow-hidden pointer-events-none">
    <div class="absolute top-20 right-10 w-32 h-32 border border-green-700 rotate-45"></div>
    <div class="absolute bottom-20 left-20 w-24 h-24 bg-green-700 rounded-full blur-xl"></div>
    <div class="absolute top-1/3 right-1/4 w-16 h-16 border-2 border-green-700/30 rounded-full"></div>
  </div>

  <div class="container mx-auto px-6 relative z-10">
    <!-- En-tête -->
    <div class="text-center mb-12">
      <div
        class="inline-flex items-center gap-2 bg-green-700/10 border border-green-700/20 rounded-full px-4 py-2 text-sm font-medium text-green-700 mb-6">
        <span class="w-2 h-2 bg-green-700 rounded-full animate-pulse"></span>
        Réservation
      </div>

      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">
        Configurez votre <span class="text-green-700">expérience</span>
      </h1>

      <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
        Sélectionnez vos garanties et définissez la période de votre location
      </p>
    </div>

    <!-- Loading State -->
    @if (loading && !error) {
      <div class="flex flex-col items-center justify-center py-20">
        <p-progress-spinner styleClass="w-12 h-12" strokeWidth="3"/>
        <p class="text-gray-600 dark:text-gray-300 mt-4">Chargement des informations...</p>
      </div>
    }

    <!-- Error State -->
    @if (error) {
      <div class="bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 p-6 rounded-lg mb-8">
        <div class="flex items-center">
          <i class="ri-error-warning-line text-red-500 text-xl mr-3"></i>
          <p class="text-red-700 dark:text-red-300 font-medium">
            Une erreur s'est produite lors du chargement des données.
          </p>
        </div>
      </div>
    }

    <!-- Contenu principal -->
    @if (!loading && !error && car()) {
      <!-- Véhicule sélectionné -->
      <div class="mb-12">
        <div
          class="bg-white dark:bg-gray-800 border-2 border-gray-100 dark:border-gray-700 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-gradient-to-r from-green-700 to-green-600 px-6 py-4">
            <h2 class="text-xl font-bold text-white flex items-center gap-3">
              <i class="ri-car-line text-2xl"></i>
              Véhicule sélectionné
            </h2>
          </div>

          <div class="p-6">
            <div class="flex flex-col lg:flex-row gap-6">
              <div class="lg:w-80 flex-shrink-0">
                <img
                  [src]="car()?.image"
                  alt="Image du véhicule"
                  class="w-full h-48 lg:h-56 object-cover rounded-xl shadow-md"
                >
              </div>

              <div class="flex-1 space-y-4">
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">
                  {{ car()?.name }}
                </h3>

                <div class="flex flex-wrap gap-6 text-gray-600 dark:text-gray-300">
                  <div class="flex items-center gap-2">
                    <i class="ri-roadster-line text-green-700"></i>
                    <span>{{ car()?.miles }} miles</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <i class="ri-building-line text-green-700"></i>
                    <span>{{ car()?.agency?.name }}</span>
                  </div>
                </div>

                <p class="text-gray-600 dark:text-gray-300 leading-relaxed">
                  {{ car()?.description }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section garanties et dates -->
      <div class="grid lg:grid-cols-2 gap-8">
        <!-- Garanties -->
        <div
          class="bg-white dark:bg-gray-800 border-2 border-gray-100 dark:border-gray-700 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-gradient-to-r from-blue-600 to-blue-500 px-6 py-4">
            <h2 class="text-xl font-bold text-white flex items-center gap-3">
              <i class="ri-shield-check-line text-2xl"></i>
              Choisissez votre garantie
            </h2>
          </div>

          <div class="p-6">
            @if (guarantees().length === 0) {
              <div class="text-center py-8">
                <i class="ri-shield-line text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500 dark:text-gray-400">Aucune garantie disponible</p>
              </div>
            } @else {
              <div class="space-y-3">
                @for (guarantee of guarantees(); track guarantee.id) {
                  <div
                    class="border-2 rounded-xl p-4 cursor-pointer transition-all duration-300 hover:shadow-md"
                    [class]="isGuaranteeSelected(guarantee.id)
                      ? 'border-green-700 bg-green-50 dark:bg-green-900/20'
                      : 'border-gray-200 dark:border-gray-600 hover:border-gray-300'"
                    (click)="selectGuarantee(guarantee.id)">

                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-2">
                          Garantie #{{ guarantee.id }}
                        </h4>

                        <div class="space-y-1 text-sm text-gray-600 dark:text-gray-300">
                          <p>État: <span class="font-medium">{{ guarantee.state }}</span></p>
                          <p>Pourcentage: <span class="font-medium text-green-700">{{ guarantee.amount * 100 }}%</span>
                          </p>
                          <p>Créée le: <span class="font-medium">{{ guarantee.createdAt | date:'dd/MM/yyyy' }}</span>
                          </p>
                        </div>
                      </div>

                      <div class="ml-4">
                        @if (isGuaranteeSelected(guarantee.id)) {
                          <div class="w-6 h-6 bg-green-700 rounded-full flex items-center justify-center">
                            <i class="ri-check-line text-white text-sm"></i>
                          </div>
                        } @else {
                          <div class="w-6 h-6 border-2 border-gray-300 rounded-full"></div>
                        }
                      </div>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>

        <!-- Dates -->
        <div
          class="bg-white dark:bg-gray-800 border-2 border-gray-100 dark:border-gray-700 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-gradient-to-r from-purple-600 to-purple-500 px-6 py-4">
            <h2 class="text-xl font-bold text-white flex items-center gap-3">
              <i class="ri-calendar-line text-2xl"></i>
              Période de location
            </h2>
          </div>

          <div class="p-6 space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="ri-calendar-event-line text-green-700 mr-1"></i>
                Date de départ
              </label>
              <input
                type="date"
                [(ngModel)]="startDate"
                class="w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-green-700 focus:ring-4 focus:ring-green-700/20 transition-all duration-300"
                required
              >
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="ri-calendar-check-line text-green-700 mr-1"></i>
                Date de retour
              </label>
              <input
                type="date"
                [(ngModel)]="endDate"
                class="w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-green-700 focus:ring-4 focus:ring-green-700/20 transition-all duration-300"
                required
              >
              @if (dateError) {
                <p class="text-red-500 text-sm mt-2 flex items-center gap-1">
                  <i class="ri-error-warning-line"></i>
                  {{ dateError }}
                </p>
              }
            </div>

            <!-- Résumé -->
            @if (startDate && endDate && !dateError) {
              <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-xl p-4">
                <h4 class="font-semibold text-green-800 dark:text-green-200 mb-2">Résumé</h4>
                <p class="text-sm text-green-700 dark:text-green-300">
                  Durée: {{ calculateDurationInDays() }} jour(s)
                </p>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Bouton continuer -->
      <div class="mt-12 text-center">
        <button
          (click)="next()"
          [disabled]="!isValid()"
          class="group bg-green-700 hover:bg-green-800 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 disabled:transform-none disabled:hover:scale-100 flex items-center justify-center gap-3 mx-auto">
          <span>Continuer vers les options</span>
          <i class="ri-arrow-right-line group-hover:translate-x-1 transition-transform"></i>
        </button>
      </div>
    }
  </div>
</section>
